function init_portfolio() {
  $(function () {
    $(".mix-grid").mixitup();

    $(".gallery-button").on("click", function () {
      // get gallery
      let group_id = $(this).data("group_id");

      $.ajax({
        type: "POST",
        url: url_gallery,
        dataType: "json",
        data: {
          group_id: group_id,
        },
        error: function (jqXHR, textStatus, errorThrown) {},
        success: function (data) {
          console.log(data);
          $.fancybox.open(data);
        },
      });
    });
  });
}

function init_canvas(username) {
  //Initializing the product with only one template - "businesscard2_side1.psd".
  productDefinition = {
    surfaces: ["test-page", "name-photo"],
  };

  //Defining the editor configuration.
  configuration = { initialMode: "Advanced", userId: username };

  //Getting the iframe element to display the editor in.
  var iframe = document.getElementById("editorFrame");
  var editor = null;
  var loadData = null;

  //Loading the editor.
  CustomersCanvas.IframeApi.loadEditor(iframe, productDefinition, configuration)
    //If the editor has been successfully loaded.
    .then(function (e) {
      editor = e;
    })
    //If there was an error thrown when loading the editor.
    .catch(function (error) {
      console.error("The editor failed to load with an exception: ", error);
    });

  var currentPage = "design";

  //Object containing data generated by getProofImages.
  var approveData = null;

  //Object containing data generated by finishProductDesign.
  var renderData = null;

  //Object containing data generated by saveProduct.
  var saveData = null;

  //Saving the product.
  $("#editorPage #saveButton").click(function () {
    editor
      .saveProduct()
      //If the product has been successfully saved.
      .then(function (result) {
        //Saving the product state info.
        saveData = result;
      })
      //If there was an error thrown when saving the product.
      .catch(function (error) {
        saveData = handleError(error, "Save failed with exception: ");
      });
  });

  //Getting links to proof images.
  $("#editorPage #nextButton").click(function () {
    editor
      .getProofImages()
      //If proof images have been successfully received.
      .then(function (result) {
        //Saving proof images info.
        approveData = result;

        //Go to the approval page.
        goToPage("approve");
      })
      //If there was an error thrown while getting the proof images.
      .catch(function (error) {
        approveData = handleError(
          error,
          "Getting proof images failed with exception: "
        );
      });
  });

  //Finishing the product customization.
  $("#approvePage #approveButton").click(function () {
    editor
      .finishProductDesign()
      //If the product customization has been successfully completed.
      .then(function (result) {
        //Saving hi-res output info.
        renderData = result;

        //Go to the finish page.
        goToPage("finish");
      })
      //If there was an error thrown while finishing the product customization.
      .catch(function (error) {
        renderData = handleError(
          error,
          "Product customization completion failed with exception: "
        );
      });
  });

  //Opening a new product in the designer.
  $("#finishOrderPage #newDesign").click(function () {
    editor.revertProduct();
    goToPage("design");
  });

  //Reopening the product in the designer.
  $("#approvePage #lnkEditAgain").click(function () {
    goToPage("design");
  });

  //Initializing the approval and finish pages with the product info.

  //Initializing the approval page with links to the proof images.
  function setApprovePageData() {
    var previewElements = $("#approvePage .previewImg").attr("src", "");
    for (
      var i = 0;
      i < approveData.proofImageUrls.length && i < previewElements.length;
      i++
    ) {
      previewElements[i].setAttribute("src", approveData.proofImageUrls[i]);
    }
  }

  //Initializing the finish page with the print-ready output URL and a link for reopening the product in the designer for further editing.
  function setFinishPageData() {
    $("#finishOrderPage #hiResLink").attr(
      "href",
      renderData.hiResOutputUrls[0]
    );
  }

  //The wizard navigation.

  function goToPage(to) {
    setupPage(to);
  }
  window.onpopstate = function (e) {
    setupPage(e.state);
  };

  var workflowPages = {
    design: { elements: $("#editorPage") },
    approve: { elements: $("#approvePage"), setData: setApprovePageData },
    finish: { elements: $("#finishOrderPage"), setData: setFinishPageData },
  };

  function setupPage(page) {
    var destPageData = workflowPages[page];

    if (typeof destPageData.setData === "function") destPageData.setData();

    workflowPages[currentPage].elements.fadeOut(function () {
      destPageData.elements.show();

      currentPage = page;
    });
  }
}
